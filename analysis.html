<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºåœ°åˆ†æå„€è¡¨æ¿</title>
    <style>
        /* (ä¿ç•™ä¹‹å‰çš„ CSS) */
        :root { --bg-color: #f3f4f6; --sidebar-bg: #ffffff; --card-bg: #ffffff; --primary: #6366f1; --primary-light: #e0e7ff; --text-dark: #1f2937; --text-gray: #6b7280; --border-color: #e5e7eb; --input-bg: #f9fafb; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; }
        body { background-color: var(--bg-color); display: flex; height: 100vh; overflow: hidden; color: var(--text-dark); }
        .sidebar { width: 380px; background-color: var(--sidebar-bg); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 24px; overflow-y: auto; box-shadow: 4px 0 15px rgba(0,0,0,0.03); z-index: 10; }
        
        /* ä¿®æ”¹ï¼šè®“ Header çœ‹èµ·ä¾†å¯ä»¥é»æ“Š */
        .brand-header { display: flex; align-items: center; gap: 12px; margin-bottom: 24px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); cursor: pointer; transition: opacity 0.2s; }
        .brand-header:hover { opacity: 0.7; }

        .brand-header img { height: 40px; width: auto; }
        .brand-header h2 { font-size: 1.2rem; color: var(--text-dark); font-weight: 700; }
        .section-title { font-size: 0.85rem; font-weight: 700; color: var(--text-gray); text-transform: uppercase; letter-spacing: 0.05em; margin: 24px 0 12px 0; border-bottom: 1px solid var(--border-color); padding-bottom: 8px; }
        .input-group { margin-bottom: 16px; }
        .input-group label { display: block; font-size: 0.9rem; font-weight: 500; margin-bottom: 6px; color: var(--text-dark); }
        .input-wrapper { position: relative; display: flex; align-items: center; }
        input[type="text"], input[type="number"] { width: 100%; padding: 10px 12px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--input-bg); font-size: 0.95rem; transition: all 0.2s; }
        input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px var(--primary-light); background-color: #fff; }
        .unit { position: absolute; right: 12px; font-size: 0.85rem; color: var(--text-gray); pointer-events: none; }
        .input-blue { border-left: 4px solid #60a5fa; }
        .main { flex: 1; padding: 32px; overflow-y: auto; display: flex; flex-direction: column; gap: 24px; }
        .kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
        .card { background: var(--card-bg); border-radius: 16px; padding: 24px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); border: 1px solid var(--border-color); }
        .card-title { font-size: 0.9rem; color: var(--text-gray); margin-bottom: 8px; }
        .card-value { font-size: 2.2rem; font-weight: 700; color: var(--text-dark); }
        .card-value small { font-size: 1rem; font-weight: 500; color: var(--text-gray); margin-left: 4px; }
        .card-highlight { background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; border: none; }
        .card-highlight .card-title { color: rgba(255,255,255,0.8); }
        .card-highlight .card-value { color: white; }
        .card-highlight .card-value small { color: rgba(255,255,255,0.8); }
        .table-container { background: var(--card-bg); border-radius: 16px; border: 1px solid var(--border-color); overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }
        .data-table { width: 100%; border-collapse: collapse; font-size: 0.95rem; }
        .data-table th, .data-table td { padding: 14px 24px; border-bottom: 1px solid var(--border-color); text-align: right; }
        .data-table th:first-child, .data-table td:first-child { text-align: left; font-weight: 500; color: var(--text-dark); width: 35%; }
        .data-table th:last-child, .data-table td:last-child { width: 15%; color: var(--text-gray); font-family: 'Courier New', Courier, monospace; }
        .data-table tr:hover { background-color: #f9fafb; }
        .row-highlight { background-color: #fffbeb; font-weight: 700; }
        .row-total { background-color: #eff6ff; font-weight: 700; color: var(--primary); }
        .badge { display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; background-color: #e0e7ff; color: #4338ca; margin-bottom: 10px; }
        .status-saved { color: green; font-size: 0.8rem; margin-left: 10px; transition: opacity 0.5s; opacity: 0; }
        
        /* æ–°å¢æŒ‰éˆ•æ¨£å¼ */
        .btn-copy {
            background-color: white;
            border: 1px solid #d1d5db;
            color: #374151;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            margin-left: 10px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .btn-copy:hover {
            background-color: #f3f4f6;
            border-color: #9ca3af;
        }
        .btn-copy:active {
            transform: translateY(1px);
        }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="brand-header" onclick="window.location.href='index.html'" title="é»æ“Šè¿”å›æª”æ¡ˆåˆ—è¡¨">
            <img src="logo.png" alt="Logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"> 
            <span style="display:none; font-size:1.5rem;">â—†</span>
            <h2>åŸºåœ°åˆ†æåƒæ•¸</h2>
        </div>

        <div class="input-group">
            <label>æª”æ¡ˆåç¨±</label>
            <input type="text" id="in_filename" class="input-blue" oninput="updateData('filename', this.value)">
        </div>
        
        <div class="section-title">åŸºæœ¬è³‡æ–™</div>
        <div class="input-group">
            <label>æ¡ˆå</label>
            <input type="text" id="in_case_name" class="input-blue" oninput="updateData('åŸºæœ¬è³‡æ–™.æ¡ˆå', this.value)">
        </div>
        <div class="input-group">
            <label>ä½¿ç”¨åˆ†å€</label>
            <input type="text" id="in_zone" class="input-blue" oninput="updateData('åŸºæœ¬è³‡æ–™.ä½¿ç”¨åˆ†å€', this.value)">
        </div>

        <div class="section-title">åŸºåœ°æ¢ä»¶</div>
        <div class="input-group">
            <label>åŸºåœ°é¢ç© (mÂ²)</label>
            <div class="input-wrapper">
                <input type="number" id="in_area" class="input-blue" oninput="updateData('åŸºåœ°æ¢ä»¶.åŸºåœ°é¢ç©', this.value)">
                <span class="unit">mÂ²</span>
            </div>
        </div>
        <div class="input-group">
            <label>é¢å‰é“è·¯å¯¬åº¦ (M)</label>
            <div class="input-wrapper">
                <input type="number" id="in_road" class="input-blue" oninput="updateData('åŸºåœ°æ¢ä»¶.è·¯å¯¬', this.value)">
                <span class="unit">M</span>
            </div>
        </div>

        <div class="section-title">æ³•è¦èˆ‡çå‹µ</div>
        <div class="input-group">
            <label>æ³•å®šå»ºè”½ç‡ (%)</label>
            <div class="input-wrapper">
                <input type="number" id="in_coverage" class="input-blue" oninput="updateData('æ³•è¦åƒæ•¸.å»ºè”½ç‡', this.value)">
                <span class="unit">%</span>
            </div>
        </div>
        <div class="input-group">
            <label>æ³•å®šå®¹ç©ç‡ (%)</label>
            <div class="input-wrapper">
                <input type="number" id="in_far" class="input-blue" oninput="updateData('æ³•è¦åƒæ•¸.å®¹ç©ç‡', this.value)">
                <span class="unit">%</span>
            </div>
        </div>
        <div class="input-group">
            <label>å®¹ç§»çå‹µé¢ç© (mÂ²)</label>
            <div class="input-wrapper">
                <input type="number" id="in_bonus_transfer" class="input-blue" oninput="updateData('æ³•è¦åƒæ•¸.å®¹ç§»çå‹µ', this.value)">
                <span class="unit">mÂ²</span>
            </div>
        </div>

        <div class="section-title">å»ºç¯‰è¦åŠƒä¿‚æ•¸</div>
        <div class="input-group">
            <label>éŠ·å”®ä¿‚æ•¸</label>
            <div class="input-wrapper">
                <input type="number" id="in_sales_coeff" class="input-blue" step="0.01" oninput="updateData('å»ºç¯‰è¦åŠƒ.éŠ·å”®ä¿‚æ•¸', this.value)">
                <span class="unit">å€</span>
            </div>
        </div>
        <div class="input-group">
            <label>å±‹çªå±¤é¢ç© (mÂ²)</label>
            <div class="input-wrapper">
                <input type="number" id="in_roof_area" class="input-blue" oninput="updateData('å»ºç¯‰è¦åŠƒ.å±‹çªé¢ç©', this.value)">
                <span class="unit">mÂ²</span>
            </div>
        </div>
        <div class="input-group">
            <label>åœ°ä¸‹å±¤æ¨“åœ°æ¿é¢ç© (mÂ²)</label>
            <div class="input-wrapper">
                <input type="number" id="in_basement_area" class="input-blue" oninput="updateData('å»ºç¯‰è¦åŠƒ.åœ°ä¸‹å®¤é¢ç©', this.value)">
                <span class="unit">mÂ²</span>
            </div>
        </div>
        <div class="input-group">
            <label>è¦åŠƒæ¨“å±¤æ•¸</label>
            <div class="input-wrapper">
                <input type="number" id="in_floors" class="input-blue" oninput="updateData('å»ºç¯‰è¦åŠƒ.æ¨“å±¤æ•¸', this.value)">
                <span class="unit">å±¤</span>
            </div>
        </div>
    </div>

    <div class="main">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <div>
                <h1 id="main-title">è¼‰å…¥ä¸­...</h1>
            </div>
            <div style="display:flex; align-items:center;">
                <span class="badge">Live Edit Mode</span>
                <span id="save-status" class="status-saved">å·²å„²å­˜</span>
                
                <button class="btn-copy" onclick="copyDataObject()">
                    ğŸ“‹ è¤‡è£½ Object
                </button>
            </div>
        </div>

        <div class="kpi-grid">
            <div class="card card-highlight">
                <div class="card-title">ç¸½éŠ·åªæ•¸</div>
                <div class="card-value" id="kpi_total_sales">0 <small>åª</small></div>
            </div>
            <div class="card">
                <div class="card-title">åªæ•ˆ</div>
                <div class="card-value" style="color:var(--primary)" id="kpi_efficiency">0 <small>å€</small></div>
            </div>
            <div class="card">
                <div class="card-title">å…å»ºç¸½å®¹ç©é¢ç©</div>
                <div class="card-value" id="kpi_total_allowed">0 <small>mÂ²</small></div>
            </div>
        </div>

        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr style="background:#f9fafb;">
                        <th>åˆ†æé …ç›® (Item)</th>
                        <th>é¢ç© (mÂ²)</th>
                        <th>é¢ç© (åª)</th>
                        <th>å‚™è¨» / æ¯”ä¾‹</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>å¯ç”¨åŸºåœ°é¢ç©</td><td id="t_base_m2">0</td><td id="t_base_ping">0</td><td></td></tr>
                    <tr><td>æ³•å®šé¨æ¨“é¢ç©</td><td>0.0</td><td>0.00</td><td></td></tr>
                    <tr><td>æ³•å®šå»ºç¯‰é¢ç©</td><td id="t_footprint_m2">0</td><td id="t_footprint_ping">0</td><td id="r_coverage">0%</td></tr>
                    <tr><td>æ³•å®šå®¹ç©é¢ç© Î”FA</td><td id="t_legal_fa_m2">0</td><td id="t_legal_fa_ping">0</td><td id="r_far">0%</td></tr>
                    <tr style="color: #e11d48;"><td>å®¹ç§»çå‹µ</td><td id="t_bonus_m2">0</td><td id="t_bonus_ping">0</td><td></td></tr>
                    <tr><td>çå‹µåœè»Šé¢ç© Î”FA''</td><td>0.0</td><td>0.00</td><td></td></tr>
                    <tr><td>éƒ½å¸‚æ›´æ–°çå‹µ Î”FA'''</td><td>0.0</td><td>0.00</td><td></td></tr>
                    <tr class="row-total"><td>å…å»ºç¸½å®¹ç©é¢ç© (Î£FA)</td><td id="t_allowed_fa_m2">0</td><td id="t_allowed_fa_ping">0</td><td id="r_total_allowed"></td></tr>
                    <tr><td>æ©Ÿé›»/æ¢¯é–“ç­‰å…è¨ˆ</td><td id="t_mech_m2">0</td><td id="t_mech_ping">0</td><td id="r_mech"></td></tr>
                    <tr><td>æ¢¯å»³å…è¨ˆå®¹ç©</td><td id="t_stair_m2">0</td><td id="t_stair_ping">0</td><td id="r_stair"></td></tr>
                    <tr><td>é™½å°å…è¨ˆå®¹ç©</td><td id="t_balcony_m2">0</td><td id="t_balcony_ping">0</td><td id="r_balcony"></td></tr>
                    <tr><td>å±‹çªå±¤é¢ç©</td><td id="t_roof_m2">0</td><td id="t_roof_ping">0</td><td></td></tr>
                    <tr class="row-highlight"><td>åœ°ä¸Šå±¤æ¨“åœ°æ¿é¢ç©ç¸½è¨ˆ</td><td id="t_above_ground_m2">0</td><td id="t_above_ground_ping">0</td><td></td></tr>
                    <tr><td>åœ°ä¸‹å±¤é–‹æŒ–ç‡</td><td colspan="2" style="text-align:center">æ³•å®š 36% / å¯¦éš› 75.1%</td><td></td></tr>
                    <tr><td>åŸåœ°åŸºå»ºç¯‰å®¹ç©é¢ç©</td><td>0.0</td><td>0.00</td><td></td></tr>
                    <tr class="row-highlight"><td>åœ°ä¸‹å±¤æ¨“åœ°æ¿é¢ç©ç¸½è¨ˆ</td><td id="t_basement_m2">0</td><td id="t_basement_ping">0</td><td></td></tr>
                    <tr class="row-highlight"><td>ç¸½æ¨“åœ°æ¿é¢ç© (GFA)</td><td id="t_gfa_m2">0</td><td id="t_gfa_ping">0</td><td></td></tr>
                    <tr style="background-color: #fef08a; border: 2px solid #eab308; color: #a16207;"><td>ç¸½éŠ·åªæ•¸</td><td id="t_sales_m2" style="font-weight:bold;">0</td><td id="t_sales_ping" style="font-size:1.2rem; font-weight:bold;">0</td><td id="t_coeff_display" style="font-weight:bold; color:red">0</td></tr>
                    <tr><td>åªæ•ˆ</td><td colspan="2" id="t_efficiency" style="text-align:center; color:blue; font-weight:bold;">0</td><td></td></tr>
                    <tr><td>æ³•å®šåœè»Šæ•¸ (æ©Ÿæ¢°/å¹³é¢)</td><td colspan="2" style="text-align:center">æ±½è»Š <span id="t_car_legal">0</span> è¼› / æ©Ÿè»Š <span id="t_moto_legal">0</span> è¼›</td><td></td></tr>
                    <tr><td>è¦åŠƒåœ°ä¸Šæ¨“å±¤æ•¸/ç¸½æˆ¶æ•¸</td><td colspan="2" style="text-align:center"><span id="t_plan_floors">0</span> å±¤ / <span id="t_plan_units">0</span> æˆ¶</td><td></td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const LS_KEY = 'landAnalysisFiles';
        let currentDocId = null;
        let allDocs = [];
        let currentDoc = null;

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            currentDocId = urlParams.get('id');

            if (!currentDocId) {
                alert("ç„¡æ•ˆçš„æª”æ¡ˆ IDï¼Œè«‹å¾ç®¡ç†å¹³å°é–‹å•Ÿã€‚");
                window.close();
                return;
            }

            loadDataFromLS();
        };

        function loadDataFromLS() {
            const raw = localStorage.getItem(LS_KEY);
            if (raw) {
                allDocs = JSON.parse(raw);
                currentDoc = allDocs.find(d => d.id === currentDocId);

                if (currentDoc) {
                    populateUI(currentDoc);
                    calculate(); 
                } else {
                    alert("æ‰¾ä¸åˆ°è©²æª”æ¡ˆï¼Œå¯èƒ½å·²è¢«åˆªé™¤ã€‚");
                }
            }
        }

        function populateUI(doc) {
            const data = doc.data;
            document.getElementById('in_filename').value = doc.filename; 
            document.getElementById('in_case_name').value = data['åŸºæœ¬è³‡æ–™']['æ¡ˆå'];
            document.getElementById('in_zone').value = data['åŸºæœ¬è³‡æ–™']['ä½¿ç”¨åˆ†å€'];
            document.getElementById('in_area').value = data['åŸºåœ°æ¢ä»¶']['åŸºåœ°é¢ç©'];
            document.getElementById('in_road').value = data['åŸºåœ°æ¢ä»¶']['è·¯å¯¬'];
            document.getElementById('in_coverage').value = data['æ³•è¦åƒæ•¸']['å»ºè”½ç‡'];
            document.getElementById('in_far').value = data['æ³•è¦åƒæ•¸']['å®¹ç©ç‡'];
            document.getElementById('in_bonus_transfer').value = data['æ³•è¦åƒæ•¸']['å®¹ç§»çå‹µ'];
            document.getElementById('in_sales_coeff').value = data['å»ºç¯‰è¦åŠƒ']['éŠ·å”®ä¿‚æ•¸'];
            document.getElementById('in_roof_area').value = data['å»ºç¯‰è¦åŠƒ']['å±‹çªé¢ç©'];
            document.getElementById('in_basement_area').value = data['å»ºç¯‰è¦åŠƒ']['åœ°ä¸‹å®¤é¢ç©'];
            document.getElementById('in_floors').value = data['å»ºç¯‰è¦åŠƒ']['æ¨“å±¤æ•¸'];
            
            document.getElementById('main-title').innerText = doc.filename;
        }

        function updateData(path, value) {
            if (!currentDoc) return;

            let finalValue = value;
            if (path !== 'filename' && path !== 'åŸºæœ¬è³‡æ–™.æ¡ˆå' && path !== 'åŸºæœ¬è³‡æ–™.ä½¿ç”¨åˆ†å€') {
                finalValue = parseFloat(value) || 0;
            }

            if (path === 'filename') {
                currentDoc.filename = finalValue;
                currentDoc.data['æª”æ¡ˆåç¨±'] = finalValue;
                document.getElementById('main-title').innerText = finalValue;
            } else {
                const parts = path.split('.');
                currentDoc.data[parts[0]][parts[1]] = finalValue;
            }

            const d = new Date();
            currentDoc.lastModified = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

            saveToLS();
            calculate();
        }

        function saveToLS() {
            const index = allDocs.findIndex(d => d.id === currentDocId);
            if (index !== -1) {
                allDocs[index] = currentDoc;
                localStorage.setItem(LS_KEY, JSON.stringify(allDocs));
                
                const status = document.getElementById('save-status');
                status.style.opacity = 1;
                setTimeout(() => { status.style.opacity = 0; }, 1000);
            }
        }

        // 3. ä¿®æ”¹ï¼šæ–°å¢è¤‡è£½ Object çš„åŠŸèƒ½
        function copyDataObject() {
            if (!currentDoc) return;
            // å°‡ç›®å‰çš„æª”æ¡ˆè³‡æ–™è½‰ç‚º JSON å­—ä¸² (æ’ç‰ˆç¸®æ’ 4 ç©ºæ ¼æ¯”è¼ƒå¥½çœ‹)
            const dataStr = JSON.stringify(currentDoc.data, null, 4);
            
            // å¯«å…¥å‰ªè²¼ç°¿
            navigator.clipboard.writeText(dataStr).then(() => {
                alert("âœ… å·²è¤‡è£½æª”æ¡ˆ Objectï¼\n\næ‚¨å¯ä»¥å›åˆ°é¦–é ï¼Œé»æ“Šã€ŒåŒ¯å…¥ Objectã€ä¸¦è²¼ä¸Šæ­¤å…§å®¹ä¾†å‚™ä»½æˆ–åˆ†äº«ã€‚");
            }).catch(err => {
                console.error('è¤‡è£½å¤±æ•—: ', err);
                alert("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–è¤‡è£½ã€‚");
            });
        }

        function calculate() {
            const areaM2 = parseFloat(document.getElementById('in_area').value) || 0;
            const coveragePct = parseFloat(document.getElementById('in_coverage').value) || 0;
            const farPct = parseFloat(document.getElementById('in_far').value) || 0;
            const bonusTransferM2 = parseFloat(document.getElementById('in_bonus_transfer').value) || 0;
            const salesCoeff = parseFloat(document.getElementById('in_sales_coeff').value) || 1.62;
            const roofAreaM2 = parseFloat(document.getElementById('in_roof_area').value) || 0;
            const basementAreaM2 = parseFloat(document.getElementById('in_basement_area').value) || 0;
            const planFloors = parseFloat(document.getElementById('in_floors').value) || 11;
            const m2ToPing = 0.3025;

            const areaPing = areaM2 * m2ToPing;
            const legalFootprintM2 = areaM2 * (coveragePct / 100);
            const legalFAM2 = areaM2 * (farPct / 100);
            const allowedTotalFAM2 = legalFAM2 + bonusTransferM2;
            const calc_Mech = allowedTotalFAM2 * 0.15;
            const calc_Stair = 509.2 * (allowedTotalFAM2 / 5882.8); 
            const calc_Balcony = 582.0 * (allowedTotalFAM2 / 5882.8); 
            const aboveGroundTotalM2 = allowedTotalFAM2 + calc_Mech + calc_Stair + calc_Balcony + roofAreaM2;
            const totalGFAM2 = aboveGroundTotalM2 + basementAreaM2;
            const totalSalesM2 = allowedTotalFAM2 * salesCoeff; 
            const totalSalesPing = totalSalesM2 * m2ToPing;
            const efficiency = areaPing > 0 ? (totalSalesPing / areaPing) : 0;
            const carVal = allowedTotalFAM2 * 0.00773;
            const motoVal = 73 * (allowedTotalFAM2 / 5882.8);
            const ratioTotalAllowed = areaM2 > 0 ? (allowedTotalFAM2 / areaM2) * 100 : 0;
            const ratioMech = allowedTotalFAM2 > 0 ? (calc_Mech / allowedTotalFAM2) * 100 : 0;
            const ratioStair = allowedTotalFAM2 > 0 ? (calc_Stair / allowedTotalFAM2) * 100 : 0;
            const ratioBalcony = allowedTotalFAM2 > 0 ? (calc_Balcony / allowedTotalFAM2) * 100 : 0;

            const setVal = (id, val, isPing = false) => {
                const el = document.getElementById(id);
                if(el) el.innerText = val.toLocaleString('en-US', {minimumFractionDigits: isPing? 2 : 1, maximumFractionDigits: 2});
            };
            setVal('kpi_total_sales', totalSalesPing, true);
            setVal('kpi_efficiency', efficiency, true);
            setVal('kpi_total_allowed', allowedTotalFAM2);
            setVal('t_base_m2', areaM2);
            setVal('t_base_ping', areaPing, true);
            setVal('t_footprint_m2', legalFootprintM2);
            setVal('t_footprint_ping', legalFootprintM2 * m2ToPing, true);
            document.getElementById('r_coverage').innerText = coveragePct.toFixed(2) + "%";
            setVal('t_legal_fa_m2', legalFAM2);
            setVal('t_legal_fa_ping', legalFAM2 * m2ToPing, true);
            document.getElementById('r_far').innerText = farPct.toFixed(2) + "%";
            setVal('t_bonus_m2', bonusTransferM2);
            setVal('t_bonus_ping', bonusTransferM2 * m2ToPing, true);
            setVal('t_allowed_fa_m2', allowedTotalFAM2);
            setVal('t_allowed_fa_ping', allowedTotalFAM2 * m2ToPing, true);
            document.getElementById('r_total_allowed').innerText = ratioTotalAllowed.toFixed(2) + "%";
            setVal('t_mech_m2', calc_Mech);
            setVal('t_mech_ping', calc_Mech * m2ToPing, true);
            document.getElementById('r_mech').innerText = ratioMech.toFixed(2) + "%";
            setVal('t_stair_m2', calc_Stair);
            setVal('t_stair_ping', calc_Stair * m2ToPing, true);
            document.getElementById('r_stair').innerText = ratioStair.toFixed(2) + "%";
            setVal('t_balcony_m2', calc_Balcony);
            setVal('t_balcony_ping', calc_Balcony * m2ToPing, true);
            document.getElementById('r_balcony').innerText = ratioBalcony.toFixed(2) + "%";
            setVal('t_roof_m2', roofAreaM2);
            setVal('t_roof_ping', roofAreaM2 * m2ToPing, true);
            setVal('t_above_ground_m2', aboveGroundTotalM2);
            setVal('t_above_ground_ping', aboveGroundTotalM2 * m2ToPing, true);
            setVal('t_basement_m2', basementAreaM2);
            setVal('t_basement_ping', basementAreaM2 * m2ToPing, true);
            setVal('t_gfa_m2', totalGFAM2);
            setVal('t_gfa_ping', totalGFAM2 * m2ToPing, true);
            setVal('t_sales_m2', totalSalesM2);
            setVal('t_sales_ping', totalSalesPing, true);
            document.getElementById('t_coeff_display').innerText = salesCoeff.toFixed(2);
            setVal('t_efficiency', efficiency, true);
            setVal('t_car_legal', Math.floor(carVal));
            setVal('t_moto_legal', Math.floor(motoVal));
            document.getElementById('t_plan_floors').innerText = planFloors;
            document.getElementById('t_plan_units').innerText = Math.max(0, planFloors * 2 - 2); 
        }
    </script>
</body>
</html>